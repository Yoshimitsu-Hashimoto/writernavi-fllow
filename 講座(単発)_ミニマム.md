
```mermaid
sequenceDiagram
    participant H as 主催者（ライター）
    participant HF as 主催者フロント
    participant U as 受講者
    participant UF as 受講者フロント
    participant A as 管理者
    participant AF as 管理者フロント
    participant BE as バックエンド
    participant DB as データベース
    participant UP as UniPay決済
    participant EM as メール送信

    Note over H,EM: 【講座作成フロー】
    
    H->>HF: 講座作成申請入力
    HF->>BE: POST /courses/applications
    BE->>DB: 申請データ保存
    BE->>EM: 申請受付メール送信
    EM->>H: 申請受付通知
    BE->>EM: 管理者審査依頼メール
    EM->>A: 審査依頼通知

    A->>AF: 申請審査画面確認
    AF->>BE: GET /admin/course-applications
    BE->>DB: 申請データ取得
    A->>AF: 審査結果入力（承認/却下）
    
    alt 承認の場合
        AF->>BE: POST /admin/applications/{id}/approve
        BE->>DB: 申請ステータス更新
        BE->>EM: 承認通知メール送信
        EM->>H: 承認通知受信
        
        H->>HF: 講座詳細設定
        HF->>BE: PUT /courses/{id}
        BE->>DB: 講座情報保存
        
        H->>HF: 講座資料アップロード
        HF->>BE: POST /courses/{id}/materials
        BE->>DB: 資料情報保存
        
        H->>HF: 講座公開設定
        HF->>BE: PATCH /courses/{id}/status
        BE->>DB: 公開ステータス更新
        
    else 却下の場合
        AF->>BE: POST /admin/applications/{id}/reject
        BE->>DB: 申請ステータス更新
        BE->>EM: 却下通知メール送信
        EM->>H: 却下理由通知
    end

    Note over H,EM: 【講座受講フロー】
    
    U->>UF: 講座検索・一覧確認
    UF->>BE: GET /courses?category=SEO
    BE->>DB: 講座データ取得
    
    U->>UF: 講座詳細確認
    UF->>BE: GET /courses/{id}
    BE->>DB: 講座詳細取得
    
    UF->>BE: GET /courses/{id}/reviews
    BE->>DB: レビューデータ取得
    
    U->>UF: 講座申込
    UF->>BE: POST /course-applications
    BE->>DB: 申込データ保存
    
    U->>UF: 決済画面へ
    UF->>BE: GET /payment-methods
    BE->>DB: 保存済み決済方法取得
    
    alt 新規カードの場合
        U->>UF: カード情報入力
        UF->>UP: カード情報送信
        UP->>UF: 決済トークン返却
    else 保存済みカードの場合
        U->>UF: 保存カード選択
        UF->>BE: 保存カード情報取得
        BE->>UP: 決済トークン要求
        UP->>BE: 決済トークン返却
    end
    
    UF->>BE: POST /payments/process
    BE->>UP: 決済実行
    UP->>BE: 決済結果返却
    
    alt 決済成功の場合
        BE->>DB: 申込確定、決済情報保存
        BE->>EM: 申込確定メール送信
        EM->>U: 申込確定通知
        EM->>H: 新規申込通知
        
        U->>UF: 受講準備（資料ダウンロード等）
        UF->>BE: GET /courses/{id}/materials
        BE->>DB: 受講者向け資料取得
        
        Note over U,H: 講座実施
        
        U->>UF: 講座レビュー投稿
        UF->>BE: POST /courses/{id}/reviews
        BE->>DB: レビューデータ保存
        BE->>EM: レビュー投稿通知
        EM->>H: レビュー通知受信
        
    else 決済失敗の場合
        BE->>EM: 決済エラーメール送信
        EM->>U: 決済失敗通知
    end

    Note over H,EM: 【売上管理フロー】
    
    H->>HF: 売上確認
    HF->>BE: GET /courses/{id}/revenue
    BE->>DB: 売上データ取得
    
    H->>HF: 振込申請
    HF->>BE: POST /payouts/requests
    BE->>DB: 振込申請データ保存
    BE->>EM: 振込申請受付メール
    EM->>H: 申請受付通知
    BE->>EM: 管理者振込審査依頼
    EM->>A: 振込審査依頼通知
    
    A->>AF: 振込申請審査
    AF->>BE: GET /admin/payouts
    BE->>DB: 振込申請データ取得
    
    A->>AF: 振込承認
    AF->>BE: POST /admin/payouts/{id}/approve
    BE->>DB: 振込ステータス更新
    BE->>EM: 振込完了メール送信
    EM->>H: 振込完了通知

    Note over H,EM: 【受講者管理フロー】
    
    H->>HF: 受講者一覧確認
    HF->>BE: GET /courses/{id}/participants
    BE->>DB: 受講者データ取得
    
    H->>HF: 受講者へメッセージ送信
    HF->>BE: POST /courses/{id}/messages
    BE->>DB: メッセージ保存
    BE->>EM: 受講者向けメッセージ送信
    EM->>U: 主催者からのメッセージ受信